

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Fortran Unicode when ISO_10646 is not supported">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="./favicon.png">

    <title> M_unicode </title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="./css/fontawesome.min.css" rel="stylesheet">
    <link href="./css/brands.min.css" rel="stylesheet">
    <link href="./css/regular.min.css" rel="stylesheet">
    <link href="./css/solid.min.css" rel="stylesheet">
    <link href="./css/v4-font-face.min.css" rel="stylesheet">
    <link href="./css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="./css/local.css" rel="stylesheet">
    <link href="./css/pygments.css" rel="stylesheet">
    <script src="./js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="./index.html">M_unicode </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="./lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/types.html">Derived Types</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/programs.html">Programs</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="./search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <!-- Main component for a primary marketing message or call to action -->
    <div class="p-5 mb-4 bg-light border rounded-3" id="jumbotron">
      <p>Fortran Unicode when ISO_10646 is not supported</p>
        <p> Find us on&hellip;</p>
      <p>
        <a class="btn btn-lg btn-primary" href="https://github.com/urbanjost/M_unicode" role="button">GitHub</a>
        
        
        
        
        <a class="btn btn-lg btn-danger" style="float:right" href="https://github.com/urbanjost/M_unicode/archive/refs/heads/master.zip" role="button">Download the Source</a>
      </p>
    </div>

      <div class="row" id='text'>
        <div class=col-md-8>
          <h1>M_unicode</h1>
          <!--
author_pic:
twitter:
website:
-->
<h2 id="note">Note:</h2>
<p>The UDDTIO (User-Defined Derived-Type Input/Output) procedures for use
with the DT edit descriptor are still undergoing development.</p>
<h1 id="m_unicode-module">M_unicode module</h1>
<p><a href="https://github.com/urbanjost/M_unicode/releases/tag/v1.0.0"><img alt="M_unicode module" src="docs/images/Phaistos_Disk_sideA.jpg"></a></p>
<p>The <strong>M_unicode</strong> module supports using UTF-8 encoded files and data as
easily as ASCII-7 encoded files.</p>
<p>It fully implements the basics discussed in the Fortran Wiki <a href="https://fortranwiki.org/fortran/show/Unicode">Unicode
Lessons</a>.</p>
<p>Furthermore, the <strong>M_unicode</strong> module supports many string methods that
operate on byte streams representing UTF-8 encoded text such as case
conversion and sorting.</p>
<p>ASCII-7 being a subset of UTF-8 the procedures work with standard ASCII-7
text as well.</p>
<p>A user-defined type called <strong>unicode_type</strong> provides an object-oriented
interface supporting ragged arrays of strings and Unicode codepoints.</p>
<p>The procedural interface supports all basic character intrinsics and
operators.</p>
<p>Over 45 <a href="example">example programs</a> are included, as well as man-pages
describing the procedures in *roff and html format, and a basic set of
unit tests.</p>
<div class="codehilite"><pre><span></span><code><span class="k">program </span><span class="n">testit</span>
<span class="k">use</span><span class="p">,</span><span class="w"> </span><span class="k">intrinsic</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iso_fortran_env</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">stdout</span><span class="o">=&gt;</span><span class="n">output_unit</span>

<span class="c">! explicit USE statements for each feature:</span>
<span class="c">!</span>
<span class="c">! user-defined type to hold Unicode text</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">unicode_type</span>

<span class="c">! convert unicode_type to CHARACTER variables</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">character</span>

<span class="c">! intrinsic overloads</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">   </span><span class="nb">adjustl</span><span class="p">,</span><span class="w">  </span><span class="nb">adjustr</span><span class="p">,</span><span class="w">   </span><span class="nb">trim</span><span class="p">,</span><span class="w">    </span><span class="nb">len</span><span class="p">,</span><span class="w">     </span><span class="nb">len_trim</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span>
<span class="w">   </span><span class="nb">index</span><span class="p">,</span><span class="w">    </span><span class="nb">scan</span><span class="p">,</span><span class="w">      </span><span class="nb">verify</span><span class="p">,</span><span class="w">  </span><span class="nb">repeat</span><span class="p">,</span><span class="w">  </span><span class="nb">ichar</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w">          </span>
<span class="w">   </span><span class="n">split</span><span class="p">,</span><span class="w">    </span><span class="n">tokenize</span><span class="w">  </span>

<span class="c">! additional methods</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">   </span><span class="n">upper</span><span class="p">,</span><span class="w">   </span><span class="n">lower</span><span class="p">,</span><span class="w">  </span><span class="n">sort</span><span class="p">,</span><span class="w">  </span><span class="n">expandtabs</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">   </span><span class="n">pad</span><span class="p">,</span><span class="w">     </span><span class="n">join</span><span class="p">,</span><span class="w">   </span><span class="n">fmt</span><span class="p">,</span><span class="w">   </span><span class="n">escape</span>

<span class="c">! operators (and overloads) and SORT(3f) use</span>
<span class="c">! Unicode codepoints (NOT dictionary order)</span>

<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">assignment</span><span class="p">(</span><span class="o">=</span><span class="p">)</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">&lt;=</span><span class="p">),</span><span class="w"> </span><span class="nb">lle</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">&lt;</span><span class="p">),</span><span class="w">  </span><span class="nb">llt</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">/=</span><span class="p">),</span><span class="w"> </span><span class="n">lne</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">==</span><span class="p">),</span><span class="w"> </span><span class="n">leq</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">&gt;</span><span class="p">),</span><span class="w">  </span><span class="nb">lgt</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">&gt;=</span><span class="p">),</span><span class="w"> </span><span class="nb">lge</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">//</span><span class="p">)</span>

<span class="c">! low-level text conversion to integer codepoint arrays:</span>
<span class="k">use </span><span class="n">M_unicode</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">utf8_to_codepoints</span><span class="p">,</span><span class="w"> </span><span class="n">codepoints_to_utf8</span>

<span class="c">! sample usage:</span>
<span class="c">!</span>
<span class="k">implicit none</span>
<span class="k">type</span><span class="p">(</span><span class="n">unicode_type</span><span class="p">)</span><span class="w">          </span><span class="kd">::</span><span class="w"> </span><span class="n">ustr</span>
<span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">g</span><span class="o">=</span><span class="s1">&#39;(*(g0))&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                               </span><span class="n">gi</span><span class="o">=</span><span class="s1">&#39;(*(g0,1x))&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                               </span><span class="n">gh</span><span class="o">=</span><span class="s1">&#39;(*(z0,1x))&#39;</span>
<span class="kt">integer</span><span class="w">                     </span><span class="kd">::</span><span class="w"> </span><span class="n">iostat</span>

<span class="w">   </span><span class="c">! Constructors</span>
<span class="w">   </span><span class="c">! UNICODE_VARIABLE= UNICODE_VARIABLE|CHARACTER(LEN=*)|INTEGER_ARRAY</span>

<span class="w">   </span><span class="c">! assign UTF-8 string to OOP object.</span>
<span class="w">   </span><span class="n">ustr</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Hello World and Ni Hao -- 你好  &#39;</span>

<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="kt">character</span><span class="p">(</span><span class="n">ustr</span><span class="p">)</span><span class="w"> </span><span class="c">! convert to intrinsic CHARACTER variable</span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">ustr</span><span class="p">)</span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="nb">len_trim</span><span class="p">(</span><span class="n">ustr</span><span class="p">)</span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">ustr</span><span class="p">,</span><span class="s1">&#39;你&#39;</span><span class="p">)</span>

<span class="w">   </span><span class="c">! OOPS</span>
<span class="w">   </span><span class="c">! VARIABLE%CHARACTER(start,end,step) returns a CHARACTER string</span>
<span class="w">   </span><span class="c">! VARIABLE%BYTE() returns an array of CHARACTER(len=1) values</span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w">  </span><span class="n">ustr</span><span class="p">%</span><span class="kt">character</span><span class="p">()</span><span class="w">      </span><span class="c">! convert to CHARACTER variable</span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w">  </span><span class="n">ustr</span><span class="p">%</span><span class="kt">character</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span><span class="w"> </span><span class="c">! similar to LINE(27:28) for CHARACTER</span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w">  </span><span class="n">ustr</span><span class="p">%</span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ustr</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c">! reverse string</span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w">  </span><span class="n">ustr</span><span class="p">%</span><span class="k">byte</span><span class="p">()</span><span class="w">           </span><span class="c">! convert to CHARACTER(LEN=1) type</span>
<span class="w">   </span><span class="c">! print </span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">gi</span><span class="p">)</span><span class="w"> </span><span class="n">ustr</span><span class="p">%</span><span class="n">codepoint</span><span class="p">()</span><span class="w">      </span><span class="c">! convert to Unicode codepoints</span>
<span class="w">   </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="n">gh</span><span class="p">)</span><span class="w"> </span><span class="n">ustr</span><span class="p">%</span><span class="n">codepoint</span><span class="p">()</span><span class="w">      </span><span class="c">! Hexadecimal values of codepoints</span>

<span class="k">end program </span><span class="n">testit</span>
</code></pre></div>

<h2 id="expected-output">Expected output:</h2>
<div class="codehilite"><pre><span></span><code>Hello World and Ni Hao -- 你好  
30
28
27
Hello World and Ni Hao -- 你好  
你好
  好你 -- oaH iN dna dlroW olleH
Hello World and Ni Hao -- 你好  
72 101 108 108 111 32 87 111 114 108 100 32 97 110 100 32 78 105 32 72 97 111 32 45 45 32 20320 22909 32 32
48 65 6C 6C 6F 20 57 6F 72 6C 64 20 61 6E 64 20 4E 69 20 48 61 6F 20 2D 2D 20 4F60 597D 20 20
</code></pre></div>

<h2 id="unicode-usage-from-fortran-when-utf-8-source-files-are-supported">Unicode usage from Fortran when UTF-8 source files are supported</h2>
<p>Fortran 2003 and later standards describe internal representation of
Unicode using 4-byte-per-character UCS-4 encoding for characters/glyphs,
including an ability to automatically encode and decode data read and
written to UTF-8 files.</p>
<p><strong>But Unicode ISO-10646 support is optional, ragged string arrays are
not supported as intrinsic types, no OOP interface is provided for the
intrinsic methods and there are no functions provided to convert from
UCS-4 to UTF-8 byte streams accept via reading and writing to files.</strong></p>
<p>Where Unicode <strong>is</strong> supported (ie. where CHARACTER(KIND=&rdquo;ISO_10646&rdquo;)
is provided)
The <a href="https://github.com/urbanjost/M_utf8">M_utf8</a> repository
supplements Unicode usage &ndash; emphasizing adherence to the standard to
promote portability.</p>
<p>When the compiler does <strong>not</strong> support CHARACTER(KIND=&rdquo;ISO_10646&rdquo;)
it still may support UTF-8 source files and permit entering multi-byte
Unicode characters in comments and (more importantly) in constant strings
and data. This support is now very common, as nearly all current operating
systems and many applications support UTF-8 text files.</p>
<p>But whether in input and output files, or as what-you-see-is-what-you-get
character constants the compiler will see this text as byte streams,
and will be unaware of how many Unicode glyphs/characters are represented.</p>
<p>So it may often be easy to place Unicode characters in fixed messages,
but if the text needs manipulated or processed in any way dealing with
Unicode as a raw series of 8-bit-bytes becomes complex and non-intuitive.</p>
<p>To keep processing of Unicode as simple as it is to process ASCII-7
characters the <strong>M_unicode</strong> module provides a user-defined type named
<strong>UNICODE_TYPE</strong> and a number of procedures for converting byte streams
that represent UTF8-encoded text into Unicode code points (ie, 32-bit
integer values that generally identify one specific Unicode character).</p>
<p>Additionally the most common character-related intrinsics and operators
are overloaded to work with the UNICODE_TYPE variables; and the type
is extended to include the procedures and operators as type-bound
procedures for programmers that prefer OOP (Object-Oriented Programming)
capabilities.</p>
<h3 id="utf-8-source-files-just-in-comments-and-constants">UTF-8 source files &ndash; just in comments and constants</h3>
<p>The Fortran character set is the set of characters used in constructing
Fortran code. It is now the same as the ASCII 7-bit character set sans
the unprintable control characters. The letters a-z,A-Z and digits 0-9
and underscore are the only characters allowed in operator symbols. These
same characters and the &ldquo;special&rdquo; characters (the remaining printable
ASCII 7-bit characters) are used for operators and bracketing, and
various forms of separating and delimiting other lexical tokens.</p>
<p>But what about other non-ASCII-7 characters representable by the
processor?  Possibilities include the extended ASCII characters or
multi-byte characters as defined for UTF-8 text files. The standard
states that, whatever those &ldquo;additional characters&rdquo; are, they may appear
in character constants:</p>
<div class="codehilite"><pre><span></span><code><span class="mf">6.1.6</span><span class="w">   </span><span class="n">Other</span><span class="w"> </span><span class="n">characters</span>

<span class="n">Additional</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">representable</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">processor</span><span class="p">,</span><span class="w"> </span><span class="n">but</span>
<span class="n">shall</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="kr">on</span><span class="n">ly</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="p">(</span><span class="mf">6.3.2.3</span><span class="p">,</span><span class="w"> </span><span class="mf">6.3.3.2</span><span class="p">),</span><span class="w"> </span><span class="n">character</span><span class="w"> </span><span class="n">constants</span>
<span class="p">(</span><span class="mf">7.4.4</span><span class="p">),</span><span class="w"> </span><span class="kr">input</span><span class="o">/</span><span class="n">output</span><span class="w"> </span><span class="n">records</span><span class="w"> </span><span class="p">(</span><span class="mf">12.2.2</span><span class="p">),</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">character</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">edit</span>
<span class="n">descriptors</span><span class="w"> </span><span class="p">(</span><span class="mf">13.3.2</span><span class="p">)</span><span class="mf">.</span>
</code></pre></div>

<p>Since ASCII-7-bit is a subset of UTF-8 it is very likely that if your
system supports UTF-8 files that it therefore will allow multi-byte
characters to be represented in comments and character constants.</p>
<p>But it is up to the processor whether it supports or even allows
UTF-8 files.  In the past when UTF-8 file support was rare this meant
using UTF-8 multi-byte characters in source files was likely to be
non-portable.  Now that UTF-8 files are supported on most systems this
extension can be useful, particularly with compilers that do not support
UCS-4 yet.</p>
<h3 id="note_1">NOTE:</h3>
<p><strong>If concerned about directly placing multi-byte characters into constant
strings directly in the code, support of arrays of codepoint values is
supported as well</strong>.</p>
<h3 id="environment">Environment</h3>
<p>Reading and writing properly to the screen requires that, independent
of the <strong>M_unicode</strong> module, UTF-8 files display properly.</p>
<p>This may require selecting a specific terminal emulator, setting the locale
and selecting a font that supports the Unicode characters of interest.</p>
<p>Without using any Fortran Unicode support features, if the output
is redirected to a file does it appear correctly?</p>
<div class="codehilite"><pre><span></span><code><span class="k">program </span><span class="n">multibyte</span>
<span class="k">use</span><span class="p">,</span><span class="w"> </span><span class="k">intrinsic</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iso_fortran_env</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">stdout</span><span class="o">=&gt;</span><span class="n">output_unit</span>
<span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="k">all</span><span class="o">=</span><span class="s1">&#39;(*(g0))&#39;</span>
<span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iostat</span>
<span class="w">   </span><span class="k">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">   </span><span class="s1">&#39;Confucius never claimed to be a prophet, &#39;</span><span class="w">       </span><span class="p">,&amp;</span>
<span class="w">   </span><span class="s1">&#39;but I think he foresaw AI! He said &#39;</span><span class="w">             </span><span class="p">,&amp;</span>
<span class="w">   </span><span class="s1">&#39;&#39;</span><span class="w">                                                </span><span class="p">,&amp;</span>
<span class="w">   </span><span class="s1">&#39; &quot;学而不思则罔，思而不学则殆&quot;&#39;</span><span class="w">                   </span><span class="p">,&amp;</span>
<span class="w">   </span><span class="s1">&#39;or&#39;</span><span class="w">                                              </span><span class="p">,&amp;</span>
<span class="w">   </span><span class="s1">&#39; (xué ér bù sī zé wǎng, sī ér bù xué zé dài),&#39;</span><span class="w">   </span><span class="p">,&amp;</span>
<span class="w">   </span><span class="s1">&#39;which is also&#39;</span><span class="w">                                   </span><span class="p">,&amp;</span>
<span class="w">   </span><span class="s1">&#39; &quot;To learn without thinking is to be lost, &#39;</span><span class="w">     </span><span class="p">,&amp;</span>
<span class="w">   </span><span class="s1">&#39; to think without learning is to be in danger&quot;.&#39;</span>
<span class="k">end program </span><span class="n">multibyte</span>
</code></pre></div>

<p>Does the text display properly when written to the screen?  If it does
not you need to determine how to set up a terminal on your system to
display UTF-8 data, which is system dependent.</p>
<p>Remember that unless the compiler directly supports UTF-8 representation (
so far I have identified no compilers that do so) these strings are seen
by the compiler as a string of bytes, and it is otherwise unaware they
represent Unicode characters. If they are just to be read and written
as-is as in the previous example program that is not a major concern;
but if you are manipulating or processing the strings in significant
ways is when you use the <strong>M_unicode</strong> module.</p>
<p><img alt="gmake" src="docs/images/gnu.gif"></p>
<h2 id="download-and-build-with-make1">Download and Build with Make(1)</h2>
<p>Compile the M_unicode module and build all the example programs.</p>
<div class="codehilite"><pre><span></span><code><span class="w">   </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/urbanjost/M_unicode.git
<span class="w">   </span><span class="nb">cd</span><span class="w"> </span>M_unicode/src
<span class="w">   </span><span class="c1"># change Makefile if not using one of the listed compilers</span>

<span class="w">   </span><span class="c1"># for gfortran</span>
<span class="w">   </span>make<span class="w"> </span>clean
<span class="w">   </span>make<span class="w"> </span>gfortran

<span class="w">   </span><span class="c1"># for ifort</span>
<span class="w">   </span>make<span class="w"> </span>clean
<span class="w">   </span>make<span class="w"> </span>ifort

<span class="w">   </span><span class="c1"># for nvfortran</span>
<span class="w">   </span>make<span class="w"> </span>clean
<span class="w">   </span>make<span class="w"> </span>nvfortran

<span class="w">   </span><span class="c1"># display other options (test, run, doxygen, ford, ...)</span>
<span class="w">   </span>make<span class="w"> </span><span class="nb">help</span>
</code></pre></div>

<p>To install you then generally copy the <em>.mod file and </em>.a file to
   an appropriate directory.  Unfortunately, the specifics vary but in
   general if you have a directory $HOME/.local/lib and copy those files
   there then you can generally enter something like</p>
<div class="codehilite"><pre><span></span><code><span class="w">     </span>gfortran<span class="w"> </span>-L<span class="nv">$HOME</span>/.local/lib<span class="w"> </span>-lM_unicode<span class="w">  </span>myprogram.f90<span class="w"> </span>-o<span class="w"> </span>myprogram
</code></pre></div>

<p>There are different methods for adding the directory to your default
   load path, but frequently you can append the directory you have
   placed the files in into the colon-separated list of directories
   in the $LD_LIBRARY_PATH or $LIBRARY_PATH environment variable, and
   then the -L option will not be required (or it&rsquo;s equivalent in your
   programming environment).</p>
<div class="codehilite"><pre><span></span><code><span class="w">       </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$HOME</span>/.local/lib:<span class="nv">$LD_LIBRARY_PATH</span>
</code></pre></div>

<p><strong>NOTE</strong>: If you use multiple Fortran compilers you may need to create
   a different directory for each compiler. I would recommend it, such
   as $HOME/.local/lib/gfortran/.</p>
<h3 id="creating-a-shared-library">Creating a shared library</h3>
<p>If you desire a shared library as well, for gfortran you may enter</p>
<div class="codehilite"><pre><span></span><code><span class="w">     </span>make<span class="w"> </span>clean<span class="w"> </span>gfortran<span class="w"> </span>gfortran_install
</code></pre></div>

<p>and everything needed by gfortran will be placed in libgfortran/ that
   you may add to an appropriate area, such as $HOME/.local/lib/gfortran/.</p>
<div class="codehilite"><pre><span></span><code><span class="w">     </span>make<span class="w"> </span>clean<span class="w"> </span>ifort<span class="w"> </span>ifort_install<span class="w"> </span><span class="c1"># same for ifort</span>
</code></pre></div>

<p>does the same for the ifort compiler and places the output in libifort/.</p>
<h3 id="specifics-may-vary">Specifics may vary</h3>
<p>NOTE: The build instructions above are specific to a ULS (Unix-Like
   System) and may differ, especially for those wishing to generate shared
   libraries (which varies significantly depending on the programming
   environment). For some builds it is simpler to make a Makefile for
   each compiler, which might be required for a more comprehensive build
   unless you are very familiar with gmake(1).</p>
<p>If you always use one compiler it is relatively simple, otherwise
   make sure you know what your system requires and change the Makefile
   as appropriate.</p>
<p><img alt="parse" src="docs/images/fpm_logo.gif"></p>
<h2 id="build-with-fpm">Build with FPM</h2>
<p>Alternatively, fpm(1) users may download the github repository and build it with
   fpm ( as described at <a href="https://github.com/fortran-lang/fpm">Fortran Package Manager</a> )</p>
<div class="codehilite"><pre><span></span><code><span class="w">        </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/urbanjost/M_unicode.git
<span class="w">        </span><span class="nb">cd</span><span class="w"> </span>M_unicode
<span class="w">        </span>fpm<span class="w"> </span><span class="nb">test</span><span class="w">   </span><span class="c1"># build and test the module</span>
<span class="w">        </span>fpm<span class="w"> </span>install<span class="w"> </span><span class="c1"># install the module (in the default location)</span>
</code></pre></div>

<p>or just list it as a dependency in your fpm.toml project file.</p>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="k">[dependencies]</span>
<span class="w">        </span><span class="n">M_unicode</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;https://github.com/urbanjost/M_unicode.git&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<hr>
<h2 id="_1"><img alt="cmake" src="docs/images/cmake_logo-1.png"></h2>
<h2 id="download-and-build-using-cmake">Download and Build using cmake</h2>
<p>To download the github repository and build and install with cmake
(you may wish to change the install path in src/CMakeLists.txt first) :</p>
<div class="codehilite"><pre><span></span><code><span class="w">      </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/urbanjost/M_unicode.git
<span class="w">      </span><span class="nb">cd</span><span class="w"> </span>M_unicode

<span class="w">      </span><span class="c1"># Create a Build Directory:</span>
<span class="w">      </span>mkdir<span class="w"> </span>-p<span class="w"> </span>build

<span class="w">      </span><span class="nb">cd</span><span class="w"> </span>build
<span class="w">      </span>cmake<span class="w"> </span>-S<span class="w"> </span>../src<span class="w"> </span>-B<span class="w"> </span>.

<span class="w">      </span><span class="c1"># Configure the Build, specifying your preferred compiler (ifort, flang, etc.):</span>
<span class="w">      </span>cmake<span class="w"> </span>.<span class="w"> </span>-DCMAKE_Fortran_COMPILER<span class="o">=</span>gfortran

<span class="w">      </span><span class="c1"># Build the Project:</span>
<span class="w">      </span>cmake<span class="w"> </span>--build<span class="w"> </span>.

<span class="w">      </span><span class="c1">#This creates:</span>
<span class="w">      </span><span class="c1">#</span>
<span class="w">      </span><span class="c1">#    build/lib/libM_unicode.a (the static library).</span>
<span class="w">      </span><span class="c1">#    build/include/*.mod (module files).</span>
<span class="w">      </span><span class="c1">#    build/test/* (test executables).</span>
<span class="w">      </span><span class="c1">#    build/example/* (example executables).</span>

<span class="w">      </span><span class="c1"># OPTIONAL SECTION:</span>

<span class="w">      </span><span class="c1"># Verify build</span>
<span class="w">      </span>ls<span class="w"> </span>build/lib/libM_unicode.a
<span class="w">      </span>ls<span class="w"> </span>build/include/*.mod
<span class="w">      </span>ls<span class="w"> </span>build/test/*
<span class="w">      </span>ls<span class="w"> </span>build/example/*

<span class="w">      </span><span class="c1">#Optionally Run Tests and Examples:</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span>name<span class="w"> </span><span class="k">in</span><span class="w"> </span>./test/*<span class="w"> </span>./example/*
<span class="w">      </span><span class="k">do</span>
<span class="w">         </span><span class="nv">$name</span>
<span class="w">      </span><span class="k">done</span>

<span class="w">      </span><span class="c1">#Install (Optional):</span>
<span class="w">      </span><span class="c1"># This installs the library and module files to the system</span>
<span class="w">      </span><span class="c1"># (e.g., /usr/local/lib/ and /usr/local/include/).</span>
<span class="w">      </span>cmake<span class="w"> </span>--install<span class="w"> </span>.

<span class="w">      </span><span class="c1"># if you have insufficient permissions sudo(1) may be required</span>
<span class="w">      </span><span class="c1"># to perform the install</span>
<span class="w">      </span><span class="c1">#sudo cmake --install .</span>

<span class="w">      </span><span class="c1"># Verify installation</span>
<span class="w">      </span>ls<span class="w"> </span>/usr/local/lib/libM_unicode.a
<span class="w">      </span>ls<span class="w"> </span>/usr/local/include/*.mod

<span class="w">      </span><span class="c1"># Cleaning Up: To clean artifacts, remove the build/ directory:</span>
<span class="w">      </span>rm<span class="w"> </span>-rf<span class="w"> </span>build
</code></pre></div>

<h2 id="supports-meson">Supports Meson</h2>
<p>Alternatively, meson(1) users may download the github repository and build it with
   meson ( as described at <a href="https://mesonbuild.com/">Meson Build System</a> )</p>
<div class="codehilite"><pre><span></span><code><span class="w">        </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/urbanjost/M_unicode.git
<span class="w">        </span><span class="nb">cd</span><span class="w"> </span>M_unicode
<span class="w">        </span>meson<span class="w"> </span>setup<span class="w"> </span>_build
<span class="w">        </span>meson<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-C<span class="w"> </span>_build<span class="w">  </span><span class="c1"># build and test the module</span>

<span class="w">        </span><span class="c1"># install the module (in the &lt;DIR&gt; location)</span>
<span class="w">        </span><span class="c1"># --destdir is only on newer versions of meson</span>
<span class="w">        </span>meson<span class="w"> </span>install<span class="w"> </span>-C<span class="w"> </span>_build<span class="w"> </span>--destdir<span class="w"> </span>&lt;DIR&gt;
<span class="w">        </span><span class="c1"># older method if --destdir is not available</span>
<span class="w">        </span>env<span class="w"> </span><span class="nv">DESTDIR</span><span class="o">=</span>&lt;DIR&gt;<span class="w"> </span>meson<span class="w"> </span>install<span class="w"> </span>-C<span class="w"> </span>_build
</code></pre></div>

<p>or just list it as a <a href="https://mesonbuild.com/Subprojects.html">subproject dependency</a> in your meson.build project file.</p>
<div class="codehilite"><pre><span></span><code><span class="w">        </span><span class="n">M_unicode_dep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">subproject</span><span class="p">(</span><span class="s">&#39;M_unicode&#39;</span><span class="p">).</span><span class="n">get_variable</span><span class="p">(</span><span class="s">&#39;M_unicode_dep&#39;</span><span class="p">)</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>Yes, a Fortran source file can contain multibyte Unicode characters in
most environments, but the level of support and how they are handled
depends on the specific Fortran compiler and operating system and is
not otherwise defined by the Fortran standard.</p>
<p>The appearance of multi-byte characters in comments and character
constants is typically all that is allowed and compiler errors occur
when unsupported characters outside the Fortran character set are used
in the body of the code &ndash; unless the vendor extends Fortran beyond the
requirements of the Fortran standard. It is assumed here that is not the
case; so be careful that outside of quoted strings and comments that only
ASCII-7-bit characters are used to write the actual coding instructions.</p>
<p>Some editors might try to be &ldquo;helpful&rdquo; and change ASCII quote and dash
characters to other multi-byte characters when editing UTF-8 files, so
be aware you might need to normalize your source files into the allowed
Fortran character set outside of constant strings.</p>
<p>When using Unicode as byte streams avoid list-directed output. It
does not know which bytes are composing a glyph and may split lines at
inappropriate points.</p>
<h3 id="compiler-support">Compiler Support:</h3>
<p>Even with standard features, compiler support for Unicode in source
   files can vary. Some compilers might require specific flags (e.g.,
   -qmbcs for XL Fortran) or might offer better integration with
   system-level Unicode functionalities.</p>
<h3 id="source-file-encoding">Source File Encoding:</h3>
<p>The encoding of the Fortran source file itself is crucial. If the
    file is saved in a Unicode encoding like UTF-8, the compiler needs
   to be able to correctly interpret these characters during compilation.</p>
<h3 id="limitations">Limitations:</h3>
<p>While modern Fortran can handle Unicode characters, there might still be
limitations compared to languages like C++ regarding the ease of use with
complex Unicode features (e.g., surrogate pairs, text directionality,
normalization). For many uses of Unicode support of codepoints and system
support for UTF-8 encoding is sufficient, however.</p>
<p>## References
 * <a href="https://home.unicode.org/"><img alt="Unicode Home" src="docs/images/Unicode-Logo-Final-Blue-95x112.jpg"></a></p>
<ul>
<li>
<p>Initially based on a discussion begun in
https://fortran-lang.discourse.group/t/how-to-use-utf-8-in-gfortran/9949, 2025-08;
including features and enhancements from Francois Jacq.</p>
</li>
<li>
<p>The improvements include procedures for handling ASCII encoding extensions
   often used for internationalization that pre-date Unicode, such as the
   Latin encodings now in module
   <a href="https://github.com/urbanjost/M_isolatin">M_isolatin</a>.</p>
</li>
</ul>
<hr>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="https://fortran-lang.discourse.group/t/how-to-use-utf-8-in-gfortran/9949">https://fortran-lang.discourse.group/t/how-to-use-utf-8-in-gfortran/9949</a></li>
<li><a href="https://fortran-lang.discourse.group/t/how-do-i-file-read-french-special-characters-like-e-etc/6618">https://fortran-lang.discourse.group/t/how-do-i-file-read-french-special-characters-like-e-etc/6618</a></li>
<li><a href="https://fortran-lang.discourse.group/t/using-unicode-characters-in-fortran/2764">https://fortran-lang.discourse.group/t/using-unicode-characters-in-fortran/2764</a></li>
</ul>
<!--
 + [UTF-8 Everywhere Manifesto](http://utf8everywhere.org/)
-->
<hr>
        </div>
          <div class="col-md-4">
            <div class="card card-body bg-light">
              <h2 class="card-title">Developer Info</h2>
              <h4 class="card-text">John S. Urban</h4>
              <p class="card-text"></p>
                <div class="text-center"><div class="btn-group" role="group">
                    
                    <a class="btn btn-lg btn-primary" href="https://github.com/urbanjost/M_unicode"><i class="fa fa-github fa-lg"></i></a>
                    
                    
                    
                    
                    
                    
                </div></div>
            </div>
          </div>
      </div>
        <div class="row">
          <hr>
          <div class="col-xs-6 col-sm-3">
            <div>
              <h3>Source Files</h3>
              <ul><li><a href='sourcefile/bom_start.f90.html'>bom_start.f90</a></li><li><a href='sourcefile/codepoint.f90.html'>codepoint.f90</a></li><li><a href='sourcefile/concatenate.f90.html'>concatenate.f90</a></li><li><a href='sourcefile/construct.f90.html'>construct.f90</a></li><li><a href='sourcefile/count_glyphs.f90.html'>count_glyphs.f90</a></li><li><a href='sourcefile/demo_adjustl.f90.html'>demo_adjustl.f90</a></li><li><a href='sourcefile/demo_adjustr.f90.html'>demo_adjustr.f90</a></li><li><a href='sourcefile/demo_character.f90.html'>demo_character.f90</a></li><li><a href='sourcefile/demo_codepoints_to_utf8.f90.html'>demo_codepoints_to_utf8.f90</a></li><li><a href='sourcefile/demo_escape.f90.html'>demo_escape.f90</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/files.html"><em>All source files&hellip;</em></a></li>
              </ul>
            </div>
          </div>
          <div class="col-xs-6 col-sm-3">
            <div>
              <h3>Modules</h3>
              <ul><li><a href='module/m_unicode.html'>M_unicode</a></li><li><a href='module/testsuite_m_unicode.html'>testsuite_M_unicode</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/modules.html"><em>All modules&hellip;</em></a></li>
              </ul>
            </div>
          </div>
          <div class="col-xs-6 col-sm-3">
            <div>
              <h3>Procedures</h3>
              <ul><li><a href='interface/adjustl.html'>adjustl</a></li><li><a href='interface/adjustr.html'>adjustr</a></li><li><a href='proc/afmt.html'>afmt</a></li><li><a href='interface/assignment(=).html'>assignment(=)</a></li><li><a href='proc/callit.html'>callit</a></li><li><a href='interface/character.html'>character</a></li><li><a href='proc/check.html'>check</a></li><li><a href='proc/checkit.html'>checkit</a></li><li><a href='proc/checkits.html'>checkits</a></li><li><a href='proc/checkits_l.html'>checkits_l</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/procedures.html"><em>All procedures&hellip;</em></a></li>
              </ul>
            </div>
          </div>
          <div class="col-xs-6 col-sm-3">
            <div>
              <h3>Derived Types</h3>
              <ul><li><a href='type/unicode_type.html'>unicode_type</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/types.html"><em>All derived types&hellip;</em></a></li>
              </ul>
            </div>
          </div>
        </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              M_unicode
 was developed by John S. Urban<br>              &copy; 2026 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2026-01-28 13:35 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>